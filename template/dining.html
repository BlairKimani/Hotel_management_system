{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dining — Haven Hub Hotels</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
  <link rel="stylesheet" href="{%static 'style.css'%}">
  <link rel="stylesheet" href="{%static 'combined.css'%}">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar" id="navbar">
    <div class="logo">
      <a href="{%url 'index'%}">
      <img src="{%static 'images/'%}logo.png" alt="Haven Hub Hotels">
      </a>
    </div>
    {% if user.is_authenticated %}
    Welcome {{user.first_name}}
    {% endif %}
    <ul class="nav-links">
      <li><a href="{%url 'index'%}">Home</a></li>
      <li><a href="{%url 'accomodation'%}">Accomodation</a></li>
      <li><a href="#">Dining</a></li>
      <li><a href="{%url 'about'%}">About us</a></li>
      <li><a href="{%url 'index'%}#contact">Contact</a></li>
      {% if user.is_authenticated %}
      <li><a href="{%url 'logout'%}" class="btn btn-primary">Logout</a></li>
      {% else %}
      <li><a href="{%url 'login'%}" class="btn btn-primary">Book Now</a></li>
      {% endif %}
    </ul>
  </nav>

  <section class="section">
    <h2>Exquisite Dining Experience</h2>

    <div class="rooms-nav">
      <a href="#breakfast">Breakfast</a>
      <a href="#lunch">Lunch</a>
      <a href="#dinner">Dinner</a>
    </div>

    <!-- Breakfast -->
    <div class="category" id="breakfast">
      <h3>Breakfast</h3>
      <div class="card-grid">
        {% for food in foods %}
          {%if food.service_time == 'Breakfast'%}
          <div class="card">
            <img src="{% static 'images/'%}{{food.inventory_id}}.jpeg" alt="{{food.category}}: {{food.inventory_id}}">
            <div class="card-content">
              <div class="price">
                <span class="was">$10.00</span>
                <span class="now">${{food.price_per_unit}}</span>
              </div>
              {% if user.is_authenticated %}
              <button class="btn-primary" onclick="orderFood('{{food.inventory_id}}','{{food.price_per_unit}}', '4010')">Buy Now</button>
              {% else %}
              <button class="btn-primary" onclick="Login()">Buy Now</button>
              {% endif %}
            </div>
          </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <!-- Lunch -->
    <div class="category" id="lunch">
      <h3>Lunch</h3>
      <div class="card-grid">
        {% for food in foods %}
          {% if food.service_time == 'Lunch'%}
          <div class="card">
            <img src="{% static 'images/'%}{{food.inventory_id}}.jpeg" alt="{{food.category}}: {{food.inventory_id}}">
            <div class="card-content">
              <div class="price">
                <span class="was">$10.00</span>
                <span class="now">${{food.price_per_unit}}</span>
              </div>
              {% if user.is_authenticated %}
                <button class="btn-primary" onclick="orderFood('{{food.inventory_id}}','{{food.price_per_unit}}', '4010')">Buy Now</button>
              {% else %}
                <button class="btn-primary" onclick="Login()">Buy Now</button>
              {% endif %}
            </div>
          </div>
          {% endif %}
        {% endfor %}

      </div>
    </div>

    <!-- Dinner -->
    <div class="category" id="dinner">
      <h3>Dinner</h3>
      <div class="card-grid">
        {% for food in foods %}
          {%if food.service_time == 'Dinner'%}
          <div class="card">
            <img src="{% static 'images/'%}{{food.inventory_id}}.jpeg" alt="{{food.category}}: {{food.inventory_id}}">
            <div class="card-content">
              <div class="price">
                <span class="was">$10.00</span>
                <span class="now">${{food.price_per_unit}}</span>
              </div>
              {% if user.is_authenticated %}
              <button class="btn-primary" onclick="orderFood('{{food.inventory_id}}','{{food.price_per_unit}}', '4010')">Buy Now</button>
            {% else %}
              <button class="btn-primary" onclick="Login()">Buy Now</button>
            {% endif %}
            </div>
          </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </section>

  <!-- Reusable Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="{%url 'accomodation'%}">Rooms &amp; Suites</a></li>
            <li><a href="#">Dining</a></li>
            <li><a href="{%url 'about'%}">Amenities</a></li>
            <li><a href="{%url 'index'%}#contact">Contact</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Connect With Us</h4>
          <div class="social-links">
            <a href="https://facebook.com" target="_blank"><i class="fa-brands fa-facebook"></i></a>
            <a href="https://whatsapp.com" target="_blank"><i class="fa-brands fa-whatsapp"></i></a>
            <a href="https://instagram.com" target="_blank"><i class="fa-brands fa-instagram"></i></a>
            <a href="https://tiktok.com" target="_blank"><i class="fa-brands fa-tiktok"></i></a>
            <a href="https://linkedin.com" target="_blank"><i class="fa-brands fa-linkedin"></i></a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>© 2025<br>Haven Hub Hotels.<br>All rights reserved.</p>
      </div>
    </div>
  </footer>
  {% if user.is_authenticated %}
  <!-- Payment Popup -->
  <div id="payment-popup" class="popup">
    <div class="popup-content">
      <h3>Enter Quantity</h3>
      <input type="number" id="days" placeholder="Quantity" min="1">
      <button onclick="calculatePayment()">Calculate</button>
      <div id="payment-summary"></div>
      <div id="payment-methods" style="display:none;">
        <button class="payment-method" onclick="choosePaymentMethod('Mpesa')">Mpesa</button>
        <button class="payment-method" onclick="choosePaymentMethod('Bank Transfer')">Bank Transfer</button>
      </div>
    </div>
  </div>

  <script>
    let selectedPrice, selectedid, type, selectedservice, totalprice, total_days, paymentmethod;

    function orderFood(id_no, price, service) {
      selectedPrice = price;
      selectedid = id_no;
      type = "food";
      selectedservice = service;
      document.getElementById('payment-popup').style.display = 'flex';
    }

    function calculatePayment() {
      const days = document.getElementById('days').value;
      if (days && days > 0) {
        total_days = days;
        totalprice = selectedPrice * days;
        document.getElementById('payment-summary').innerHTML = `Total: $${totalprice.toFixed(2)}`;
        document.getElementById('payment-methods').style.display = 'flex';
      } else {
        alert('Please enter a valid quantity.');
      }
    }

    function choosePaymentMethod(method) {
      alert(`Payment via ${method} successful!`);
      document.getElementById('payment-popup').style.display = 'none';
      paymentmethod = method;

      sendData()
      window.location.reload();
    }

    function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                let cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    let cookie = cookies[i].trim();
                    if (cookie.startsWith(name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function sendData() {
            let myData = { 'id' : selectedid, 'type':type, 'price' : totalprice, 'payment' : paymentmethod, 'service' : selectedservice, 'days' : total_days};
            fetch('/api/process-data/', {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": getCookie("csrftoken")  // ✅ Include CSRF token
                },
                body: JSON.stringify(myData)
            }).catch(error => console.error("Error:", error));  // Ignore response
        }

        function showAlert(number) {
            alert("Please remember this PIN " + number);
        }
  </script>
  {%else%}
  <script>
    function Login(){
      window.location.href = '{%url "login"%}'
    }
  </script>
  {%endif%}
</body>
</html>